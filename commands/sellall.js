const { EmbedBuilder, ActionRowBuilder, ButtonBuilder, ButtonStyle } = require('discord.js');
const fs = require('fs');

// ÂÉπÊ†ºÂ∫´ (Âª∂Áî®ÂâõÊâçÁöÑ 80 Á®ÆÁâ©ÂìÅ‰∏≠ÁöÑ Common Á≠âÁ¥ö)
const commonPrices = {
    "ü™µ ‰πæÁá•ÁöÑÊú®È†≠": 5, "üß™ Â∞èÂûãÁîüÂëΩËó•Ê∞¥": 5, "Á≤òÁ®†ÁöÑÂè≤ËêäÂßÜÊ∂≤": 5, "Âì•Â∏ÉÊûóÁöÑÂ∞ñÁâô": 5, "ÊûØËêéÁöÑÈáéËä±": 5, "Á≤óÁ≥ôÁöÑÁ¢éÁü≥": 5, "ËùôËù†ÁöÑÁøÖËÜÄ": 5, "ÊüîËªüÁöÑÂÖîÁöÆ": 5, "Á¥îÊ∑®Ê≥âÊ∞¥": 5, "üçô ÈÅéÊúüÈ£ØÁ≥∞": 5,
        "‚õìÔ∏è ÈêµÁ§¶Áü≥": 15, "üß™ ‰∏≠ÂûãÁîüÂëΩËó•Ê∞¥": 15, "ÈäÖÁ§¶ÂéüÁü≥": 15, "ÁîüÈèΩÁöÑÈΩíËº™": 15, "Âª¢ÈêµÊ∏£": 15, "ÈªëÁÖ§ÁÇ≠": 15, "Áü≥Ëã±Á†ÇÁ¢éÂ°ä": 15, "ÁîüÈèΩÁöÑÈë∞Âåô": 15, "Á≤óÁ≥ôÁ£®ÂàÄÁü≥": 15, "‚ö° ËÉΩÈáèÈ£≤Êñô": 15,
            "üìú ÂÑ™Ë≥™ÁöÆÈù©": 30, "üß™ Â§ßÂûãÁîüÂëΩËó•Ê∞¥": 30, "ÈáéÁç∏ÂéöÁöÆÊØõ": 30, "Âº∑ÈüåËúòËõõÁµ≤": 30, "ÁôºÂÖâÁöÑÂ≠¢Â≠ê": 30, "ËÖêÁàõÁöÑÂ∏ÉÊñô": 30, "ÂΩ©Ëâ≤ÊØíËïà": 30, "Â§©ÁÑ∂ËúÇË†ü": 30, "üåÄ Âä†ÈÄüÊç≤Ëª∏": 30, "ü™µ Â†ÖÁ°¨ÁöÑÊ©°Êú®": 30,
                "‚ùÑÔ∏è ÂÜ∞Êô∂Á¢éÁâá": 60, "ü©π ÊÄ•ÊïëÂåÖ": 60, "Á°¨ÂåñÁöÑÁî≤ÊÆº": 60, "ÊÆ≠Â±çÁöÑËÖêËÇâ": 60, "ÂéöÂØ¶Ê£âÁµ®": 60, "ÂáçÂÉµÁöÑÈ≠ö": 60, "Á¥îÊ∑®Èõ™ÁêÉ": 60, "üß™ ÊäóÂØíÂêàÂäë": 60, "üç™ Âπ∏ÈÅãÈ§Ö‰πæ": 60, "‚õìÔ∏è ÁôΩÈäÄÈå†": 60,
                    "üåë ÁÑ¶ÈªëÂ≤©Áü≥": 150, "üß™ Ë∂ÖÂ§ßÂûãËó•Ê∞¥": 150, "È§òÁáºÁÅ∞Ááº": 150, "ÈªëÈêµÈå†": 150, "ÊÉ°È≠îÊñ∑Ëßí": 150, "ÁÜîÂ≤©ÊÆºÊÆòÁâá": 150, "È´òÊ∫´Ê∫∂Âäë": 150, "üß™ ÁãÇÊö¥Ëó•Âäë": 150, "üß™ ÈêµÂ£ÅËó•Âäë": 150, "üî• Á°´Á£∫Á≤âÊú´": 150
                    };

                    module.exports = {
                        name: 'sellall',
                            async execute(message, args, p, players) {
                                    if (!p.inventory || Object.keys(p.inventory).length === 0) return message.reply("üéí ËÉåÂåÖÊòØÁ©∫ÁöÑÔºåÊ≤íÊù±Ë•øÂèØË≥£„ÄÇ");

                                            // 1. ÂÖàË©¶ÁÆóÈÄôÊ¨°ËÉΩË≥£Â§öÂ∞ëÈå¢
                                                    let totalEarnings = 0;
                                                            let soldItemsCount = 0;
                                                                    for (const [itemName, count] of Object.entries(p.inventory)) {
                                                                                if (count > 0 && commonPrices[itemName]) {
                                                                                                totalEarnings += commonPrices[itemName] * count;
                                                                                                                soldItemsCount += count;
                                                                                                                            }
                                                                                                                                    }

                                                                                                                                            if (totalEarnings === 0) return message.reply("‚ö†Ô∏è Ê≤íÁôºÁèæÂèØ‰ª•Ëá™ÂãïË≤©ÂîÆÁöÑÊôÆÈÄöÁâ©Ë≥á„ÄÇ");

                                                                                                                                                    // 2. Âª∫Á´ãÁ¢∫Ë™ç Embed ËàáÊåâÈàï
                                                                                                                                                            const confirmEmbed = new EmbedBuilder()
                                                                                                                                                                        .setTitle("üí∞ ÊâπÈáèË≤©ÂîÆÁ¢∫Ë™ç")
                                                                                                                                                                                    .setColor(0xf1c40f)
                                                                                                                                                                                                .setDescription(`‰Ω†Âç≥Â∞áË≥£Âá∫ÊâÄÊúâ **ÊôÆÈÄöÁ≠âÁ¥ö** ÁöÑÁâ©Ë≥áÔºàÂÖ± \`${soldItemsCount}\` ‰ª∂Ôºâ„ÄÇ\n\nÈ†êË®àÁç≤ÂæóÈáëÂπ£Ôºö\`$${totalEarnings}\`\n\n**‚ö†Ô∏è Ê≥®ÊÑèÔºöË≤¥ÈáçÁâ©ÂìÅËàáÁ¥†Êùê‰∏çÊúÉË¢´Ë≥£Âá∫„ÄÇ**`);

                                                                                                                                                                                                        const row = new ActionRowBuilder().addComponents(
                                                                                                                                                                                                                    new ButtonBuilder().setCustomId('confirm_sell').setLabel('Á¢∫Ë™çË≤©ÂîÆ').setStyle(ButtonStyle.Success),
                                                                                                                                                                                                                                new ButtonBuilder().setCustomId('cancel_sell').setLabel('ÂèñÊ∂à').setStyle(ButtonStyle.Danger)
                                                                                                                                                                                                                                        );

                                                                                                                                                                                                                                                const response = await message.reply({ embeds: [confirmEmbed], components: [row] });

                                                                                                                                                                                                                                                        // 3. Âª∫Á´ãÊî∂ÈõÜÂô®Áõ£ËÅΩÊåâÈàïÈªûÊìä
                                                                                                                                                                                                                                                                const collector = response.createMessageComponentCollector({
                                                                                                                                                                                                                                                                            filter: i => i.user.id === message.author.id,
                                                                                                                                                                                                                                                                                        time: 30000 // 30ÁßíÂÖßË¶ÅÊ±∫ÂÆö
                                                                                                                                                                                                                                                                                                });

                                                                                                                                                                                                                                                                                                        collector.on('collect', async i => {
                                                                                                                                                                                                                                                                                                                    if (i.customId === 'confirm_sell') {
                                                                                                                                                                                                                                                                                                                                    // Âü∑Ë°åÁúüÊ≠£ÁöÑË≤©ÂîÆÈÇèËºØ
                                                                                                                                                                                                                                                                                                                                                    for (const itemName in p.inventory) {
                                                                                                                                                                                                                                                                                                                                                                        if (commonPrices[itemName]) p.inventory[itemName] = 0;
                                                                                                                                                                                                                                                                                                                                                                                        }
                                                                                                                                                                                                                                                                                                                                                                                                        p.money = (p.money || 0) + totalEarnings;

                                                                                                                                                                                                                                                                                                                                                                                                                        // Â≠òÊ™î
                                                                                                                                                                                                                                                                                                                                                                                                                                        players[message.author.id] = p;
                                                                                                                                                                                                                                                                                                                                                                                                                                                        fs.writeFileSync('./players.json', JSON.stringify(players, null, 2));

                                                                                                                                                                                                                                                                                                                                                                                                                                                                        await i.update({ content: `‚úÖ Ë≤©ÂîÆÊàêÂäüÔºÅ‰Ω†Áç≤Âæó‰∫Ü \`$${totalEarnings}\` ÈáëÂπ£„ÄÇ`, embeds: [], components: [] });
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                    } else {
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                    await i.update({ content: "‚ùå Â∑≤ÂèñÊ∂àË≤©ÂîÆ„ÄÇ", embeds: [], components: [] });
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                }
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                            collector.stop();
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                    });

                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                            collector.on('end', (collected, reason) => {
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                        if (reason === 'time') {
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                        response.edit({ content: "‚è∞ Á¢∫Ë™çË∂ÖÊôÇÔºå‰∫§ÊòìÂ∑≤ÂèñÊ∂à„ÄÇ", embeds: [], components: [] });
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                    }
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                            });
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                }
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                };