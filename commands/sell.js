const fs = require('fs');

// 1. å®šç¾©ç‰©å“æ”¶è³¼åƒ¹æ ¼åº« (å°æ‡‰ 80 ç¨®å®Œæ•´åå–®)
const itemPrices = {
    // --- ç¿¡ç¿ å¹³åŸ ($5 / $50 / $500) ---
    "ğŸªµ ä¹¾ç‡¥çš„æœ¨é ­": 5, "ğŸ§ª å°å‹ç”Ÿå‘½è—¥æ°´": 5, "ç²˜ç¨ çš„å²èŠå§†æ¶²": 5, "å“¥å¸ƒæ—çš„å°–ç‰™": 5, "æ¯èçš„é‡èŠ±": 5, "ç²—ç³™çš„ç¢çŸ³": 5, "è™è çš„ç¿…è†€": 5, "æŸ”è»Ÿçš„å…”çš®": 5, "ç´”æ·¨æ³‰æ°´": 5, "ğŸ™ éæœŸé£¯ç³°": 5,
    "ğŸŒ² å„ªè³ªæœ¨æ": 50, "ğŸ¾ é‡ç¸åˆ©çˆª": 50, "ğŸ§¶ å¼·éŸŒçº–ç¶­": 50, "ğŸ æ¯’è›‡æ¯’å›Š": 50,
    "ğŸŒ¿ ä¸–ç•Œæ¨¹å«©æ": 500, "ğŸ€ å¹¸é‹è‰": 500,
    // --- å¹½æš—ç¤¦å‘ ($15 / $150 / $1,500) ---
    "â›“ï¸ éµç¤¦çŸ³": 15, "ğŸ§ª ä¸­å‹ç”Ÿå‘½è—¥æ°´": 15, "éŠ…ç¤¦åŸçŸ³": 15, "ç”Ÿé½çš„é½’è¼ª": 15, "å»¢éµæ¸£": 15, "é»‘ç…¤ç‚­": 15, "çŸ³è‹±ç ‚ç¢å¡Š": 15, "ç”Ÿé½çš„é‘°åŒ™": 15, "ç²—ç³™ç£¨åˆ€çŸ³": 15, "âš¡ èƒ½é‡é£²æ–™": 15,
    "ğŸ¥ˆ éŠ€ç¤¦çŸ³": 150, "ğŸ§± é‹¼éµéŒ ": 150, "âš™ï¸ ç²¾æº–ç™¼æ¢": 150, "ğŸ”Œ é­”åŠ›å°ç·š": 150,
    "ğŸ’ å¥§åˆ©å“ˆé‹¼": 1500, "ğŸ’° å¤è€é‡‘å¹£": 1500,
    // --- è¿·éœ§æ£®æ— ($30 / $300 / $3,000) ---
    "ğŸ“œ å„ªè³ªçš®é©": 30, "ğŸ§ª å¤§å‹ç”Ÿå‘½è—¥æ°´": 30, "é‡ç¸åšçš®æ¯›": 30, "å¼·éŸŒèœ˜è››çµ²": 30, "ç™¼å…‰çš„å­¢å­": 30, "è…çˆ›çš„å¸ƒæ–™": 30, "å½©è‰²æ¯’è•ˆ": 30, "å¤©ç„¶èœ‚è Ÿ": 30, "ğŸŒ€ åŠ é€Ÿæ²è»¸": 30, "ğŸªµ å …ç¡¬çš„æ©¡æœ¨": 30,
    "ğŸ”» ç´…å¯¶çŸ³ç¢å¡Š": 300, "ğŸ”¹ è—å¯¶çŸ³ç¢å¡Š": 300, "ğŸ„ åƒå¹´éˆèŠ": 300, "ğŸº ç‹¼äººæ¯›çš®": 300,
    "ğŸ¾ ç‹¼ç‹åˆ©çˆª": 3000, "ğŸ’š ç¿¡ç¿ ä¹‹å¿ƒ": 3000,
    // --- å¯’å†°å‡åŸ ($60 / $600 / $6,000) ---
    "â„ï¸ å†°æ™¶ç¢ç‰‡": 60, "ğŸ©¹ æ€¥æ•‘åŒ…": 60, "ç¡¬åŒ–çš„ç”²æ®¼": 60, "æ®­å±çš„è…è‚‰": 60, "åšå¯¦æ£‰çµ¨": 60, "å‡åƒµçš„é­š": 60, "ç´”æ·¨é›ªçƒ": 60, "ğŸ§ª æŠ—å¯’åˆåŠ‘": 60, "ğŸª å¹¸é‹é¤…ä¹¾": 60, "â›“ï¸ ç™½éŠ€éŒ ": 60,
    "ğŸ§Š å†°æ²³é‹¼": 600, "âšª ç™½é‡‘ç¤¦çŸ³": 600, "ğŸ’œ ç´«æ°´æ™¶ç¢å¡Š": 600, "ğŸ“œ å¯†å°æ›¸å·": 600,
    "ğŸŒ¬ï¸ å¯’å†°ç²¾è¯": 6000, "ğŸ‰ é¾é±—ç¢å±‘": 6000,
    // --- çƒˆç„°æ·±æ·µ ($150 / $1,500 / $15,000) ---
    "ğŸŒ‘ ç„¦é»‘å²©çŸ³": 150, "ğŸ§ª è¶…å¤§å‹è—¥æ°´": 150, "é¤˜ç‡¼ç°ç‡¼": 150, "é»‘éµéŒ ": 150, "æƒ¡é­”æ–·è§’": 150, "ç†”å²©æ®¼æ®˜ç‰‡": 150, "é«˜æº«æº¶åŠ‘": 150, "ğŸ§ª ç‹‚æš´è—¥åŠ‘": 150, "ğŸ§ª éµå£è—¥åŠ‘": 150, "ğŸ”¥ ç¡«ç£ºç²‰æœ«": 150,
    "ğŸ”¥ çƒˆç„°ç²¾è¯": 1500, "ğŸ”¸ é»ƒå¯¶çŸ³ç¢å¡Š": 1500, "ğŸ’  è’¸æ±½æ ¸å¿ƒ": 1500, "âš’ï¸ å·¥åŒ éŒ˜": 1500,
    "ğŸ©¸ é¾è¡€çŸ³": 15000, "ğŸŒŒ æ··æ²Œä¹‹é­‚": 15000
};

module.exports = {
    name: 'sell',
    async execute(message, args, p, players) {
        if (!args[0]) return message.reply("ğŸ’¡ ç”¨æ³•ï¼š`~è³£ [ç‰©å“é—œéµå­—] [æ•¸é‡]`\n(ä¾‹å¦‚ï¼š`~è³£ æœ¨é ­ 10`) ");

        const searchKeyword = args[0];
        const sellAmount = parseInt(args[1]) || 1;

        // ğŸ” é—œéµï¼šåœ¨ç©å®¶èƒŒåŒ…ä¸­æ¨¡ç³Šæœå°‹ç‰©å“å…¨å
        const realItemName = Object.keys(p.inventory).find(name => 
            name.includes(searchKeyword) && p.inventory[name] > 0
        );

        // 1. æª¢æŸ¥æœå°‹çµæœ
        if (!realItemName) {
            return message.reply(`ğŸš« ä½ çš„èƒŒåŒ…è£¡æ²’æœ‰åŒ…å«ã€Œ${searchKeyword}ã€çš„ç‰©å“ï¼`);
        }

        // 2. æª¢æŸ¥æ•¸é‡æ˜¯å¦è¶³å¤ 
        if (p.inventory[realItemName] < sellAmount) {
            return message.reply(`ğŸš« ä½ çš„ \`${realItemName}\` æ•¸é‡ä¸è¶³ï¼(ç›®å‰æ“æœ‰: ${p.inventory[realItemName]})`);
        }

        // 3. æª¢æŸ¥ç³»çµ±æ”¶è³¼åƒ¹åº« (ç”¨æœå°‹åˆ°çš„å…¨åå»æŸ¥)
        const pricePerUnit = itemPrices[realItemName];
        if (!pricePerUnit) {
            return message.reply(`ğŸš« å•†åº—ä¸æ”¶è³¼ \`${realItemName}\`ï¼`);
        }

        // 4. è¨ˆç®—ä¸¦åŸ·è¡Œäº¤æ˜“
        const totalEarnings = pricePerUnit * sellAmount;
        p.inventory[realItemName] -= sellAmount;
        p.money = (p.money || 0) + totalEarnings;

        // 5. å­˜æª”
        players[message.author.id] = p;
        fs.writeFileSync('./players.json', JSON.stringify(players, null, 2));

        return message.reply(`ğŸ’° ä½ è³£å‡ºäº† **${sellAmount}** å€‹ **${realItemName}**ï¼Œç²å¾—äº† \`$${totalEarnings}\` é‡‘å¹£ï¼`);
    }
};